# .gitlab-ci.yml
image: node:latest


package line:
  image: cr.yealinkops.com/common/yarn:1.22.4
  stage: build
  tags:
    - devops_docker_runner
  cache:
    paths:
      - node_modules/
      - yarn.lock
  script:
    - yarn install -f
    - yarn run build line --release
  artifacts:
    paths:
      - packages/line/dist
    expire_in: 3 days
  only:
    - master


package template-explorer:
  image: cr.yealinkops.com/common/yarn:1.22.4
  stage: deploy
  tags:
    - devops_docker_runner
  cache:
    paths:
      - node_modules/
      - yarn.lock
  script:
    - yarn install -f
    - yarn run build template-explorer
  artifacts:
    paths:
      - packages/template-explorer
    expire_in: 3 days
  only:
    - master


package icons-explorer:
  image: cr.yealinkops.com/common/yarn:1.22.4
  stage: deploy
  tags:
    - devops_docker_runner
  cache:
    paths:
      - node_modules/
      - yarn.lock
  script:
    - yarn install -f
    - yarn run icons-explorer --build --mode=production
    - mv dist packages/icons-explorer/dist
  artifacts:
    paths:
      - packages/icons-explorer/dist
    expire_in: 3 days
  only:
    - master

pages:
  image: cr.yealinkops.com/common/yarn:1.22.4
  stage: deploy
  tags:
    - devops_docker_runner
  cache:
    paths:
      - node_modules/
      - yarn.lock
  script:
    # line 
    - mkdir -p public/line
    - mv packages/line/dist public/line/dist

    # template-explorer 
    - mv packages/template-explorer public/template-explorer

    # icons-explorer 
    - mv packages/icons-explorer/dist public/icons-explorer
  artifacts:
    paths:
      - public # artifact path 一定要在 /public , 这样 GitLab Pages 才能获取
  only:
    - master